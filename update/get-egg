#!/bin/bash
###############################################
##  tahioN - IRC Shell Matrix                ##
##  (c) kofany & yooz                        ##
###############################################

# Cyberpunk color scheme
CYAN='\033[0;36m'
YELLOW='\033[1;33m'
GREEN='\033[0;32m'
RED='\033[0;31m'
GRAY='\033[0;90m'
NC='\033[0m'

# Cyberpunk prompt
PRM="${CYAN}║${NC} ${YELLOW}⚡${NC} "

# Check home directory
if [ "${HOME}" != "/home/$(whoami)" ]; then
    echo -e "${CYAN}╔═══[${YELLOW}⚡ ACCESS DENIED ⚡${CYAN}]${NC}"
    echo -e "${PRM}${RED}Invalid home directory${NC}"
    echo -e "${PRM}${GRAY}Expected: /home/$(whoami)${NC}"
    echo -e "${CYAN}╚═══════════════════[${GRAY}tahioN security${CYAN}]${NC}"
    exit 1
fi

DC='/bin/tools/'
TOOL='egg.tar.gz'

# Interrupt handler
trap 'echo -e "\n${PRM}${YELLOW}⧗ Operation terminated${NC}"; exit 0' INT

# Display deployment prompt
echo -e "${CYAN}╔═══[${YELLOW}⚡ tahioN EGGDROP_DEPLOY ⚡${CYAN}]${NC}"
echo -e "${CYAN}║${NC}"
echo -e "${PRM}${YELLOW}⚙${NC} Deploying Eggdrop IRC bot to your home directory"
echo -e "${PRM}${CYAN}➜${NC} Target: ${YELLOW}/home/$(whoami)/eggdrop/${NC}"
echo -e "${CYAN}║${NC}"

while true; do
    echo -ne "${PRM}${GREEN}Install Eggdrop files? [y/n]${NC} "
    read -r -s -N 1 REPLY
    echo ""

    if [ "${REPLY}" = "n" ]; then
        echo -e "${CYAN}║${NC}"
        echo -e "${PRM}${YELLOW}⧗ Deployment cancelled${NC}"
        echo -e "${CYAN}║${NC}"
        echo -e "${CYAN}╚═══════════════════[${GRAY}kofany & yooz${CYAN}]${NC}"
        exit 0
    elif [ "${REPLY}" = "y" ]; then
        break
    fi
done

# Check if eggdrop directory exists
pushd "/home/$(whoami)/" &>/dev/null
FILE="$(pwd)/eggdrop/"

if [ -e "${FILE}" ]; then
    if [ ! -d "${FILE}" ]; then
        echo -e "${CYAN}║${NC}"
        echo -e "${PRM}${RED}✗ ACCESS DENIED${NC} :: Path exists but is not a directory"
        echo -e "${CYAN}║${NC}"
        echo -e "${CYAN}╚═══════════════════[${GRAY}kofany & yooz${CYAN}]${NC}"
        exit 1
    fi

    echo -e "${CYAN}║${NC}"
    echo -e "${PRM}${YELLOW}⧗ WARNING${NC} :: Directory eggdrop/ already exists"

    while true; do
        echo -ne "${PRM}${RED}Remove existing directory? [y/n]${NC} "
        read -r -s -N 1 REPLY2
        echo ""

        if [ "${REPLY2}" = "n" ]; then
            echo -e "${CYAN}║${NC}"
            echo -e "${PRM}${YELLOW}⧗ Deployment cancelled${NC}"
            echo -e "${CYAN}║${NC}"
            echo -e "${CYAN}╚═══════════════════[${GRAY}kofany & yooz${CYAN}]${NC}"
            exit 0
        elif [ "${REPLY2}" = "y" ]; then
            break
        fi
    done

    rm -R "${FILE}"
    if [ -d "${FILE}" ]; then
        echo -e "${CYAN}║${NC}"
        echo -e "${PRM}${RED}✗ ACCESS DENIED${NC} :: Failed to remove directory"
        echo -e "${CYAN}║${NC}"
        echo -e "${CYAN}╚═══════════════════[${GRAY}kofany & yooz${CYAN}]${NC}"
        exit 1
    fi
fi

# Deploy Eggdrop
echo -e "${CYAN}║${NC}"
echo -e "${PRM}${GREEN}✓ ACCESS GRANTED${NC} :: Extracting bot matrix"
echo -e "${CYAN}║${NC}"

cp "${DC}/${TOOL}" "/home/$(whoami)"
tar -xf "/home/$(whoami)/${TOOL}"
rm "/home/$(whoami)/${TOOL}"
chown -R $(whoami) "/home/$(whoami)/eggdrop/"
chmod 711 "/home/$(whoami)/eggdrop/"

echo -e "${PRM}${YELLOW}⚙${NC} Setting permissions (711)"
echo -e "${PRM}${GREEN}✓${NC} Deployment complete"
echo -e "${CYAN}║${NC}"

pushd "/home/$(whoami)/eggdrop/" &>/dev/null
ls -n

echo -e "${CYAN}║${NC}"
echo -e "${PRM}${CYAN}⬢${NC} USAGE"
echo -e "${CYAN}║${NC}"
echo -e "${PRM}  ${GREEN}➜${NC} Run: ${YELLOW}eggdrop -m yourconfig.conf${NC}"
echo -e "${PRM}  ${GREEN}➜${NC} Port range: ${CYAN}1000-5000${NC}"
echo -e "${CYAN}║${NC}"
echo -e "${CYAN}╚═══════════════════[${GRAY}kofany & yooz${CYAN}]${NC}"

exit 0
